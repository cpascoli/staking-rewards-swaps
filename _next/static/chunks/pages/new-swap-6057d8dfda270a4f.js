(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[911],{4188:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/new-swap",function(){return n(4063)}])},3111:function(t,e,n){"use strict";n.d(e,{LA:function(){return m},Qc:function(){return x},TV:function(){return v},V9:function(){return c},Wf:function(){return l},ZV:function(){return p},dQ:function(){return S},hf:function(){return g},hh:function(){return b},jv:function(){return d},kH:function(){return N},oV:function(){return w},ol:function(){return h},wn:function(){return f}});var a=n(9279),r=n(4627),o=n(391),i=n(5811),u=n(7979).m4.chainId,s=function(){var t,e=(null!==(t=(0,r.W)({contract:(0,i.sJ)(u),method:"getSwaps",args:[]}))&&void 0!==t?t:{}).value;return null===e||void 0===e?void 0:e[0].map((function(t){return j(t)}))},l=function(){var t;return null===(t=s())||void 0===t?void 0:t.filter((function(t){return void 0===t.taker.user}))},c=function(){var t;return null===(t=s())||void 0===t?void 0:t.filter((function(t){return void 0!==t.taker.user}))},d=function(t){var e,n=(null!==(e=(0,r.W)({contract:(0,i.sJ)(u),method:"getSwap",args:[t]}))&&void 0!==e?e:{}).value,a=null===n||void 0===n?void 0:n[0];if(void 0!==a)return j(a)},f=function(t){var e,n=(null!==(e=(0,r.W)({contract:(0,i.sJ)(u),method:"canSettle",args:[t]}))&&void 0!==e?e:{}).value;return[null===n||void 0===n?void 0:n[0],null===n||void 0===n?void 0:n[1]]},v=function(t){var e=(0,i.sJ)(u),n=t.map((function(t){return{contract:e,method:"canSettle",args:[t]}})),a=(0,r.G)(n),o={};return a.forEach((function(e,n){var a,r;o[t[n]]=[!0===(null===e||void 0===e||null===(a=e.value)||void 0===a?void 0:a[0]),!0===(null===e||void 0===e||null===(r=e.value)||void 0===r?void 0:r[1])]})),o},m=function(t,e){var n,o=(null!==(n=(0,r.W)({contract:(0,i.sJ)(u),method:"canWithdraw",args:e?[t,e]:[0,a.d]}))&&void 0!==n?n:{}).value;return[null===o||void 0===o?void 0:o[0],null===o||void 0===o?void 0:o[1]]},h=function(t,e){var n=(0,i.sJ)(u),o=t.map((function(t){return{contract:n,method:"canWithdraw",args:e?[t,e]:[0,a.d]}})),s=(0,r.G)(o),l={};return s.forEach((function(e,n){var a,r;l[t[n]]=[!0===(null===e||void 0===e||null===(a=e.value)||void 0===a?void 0:a[0]),!0===(null===e||void 0===e||null===(r=e.value)||void 0===r?void 0:r[1])]})),l},w=function(t){var e,n=(null!==(e=(0,r.W)({contract:(0,i.sJ)(u),method:"previewRewards",args:t?[t]:[0]}))&&void 0!==e?e:{}).value;return[null===n||void 0===n?void 0:n[0],null===n||void 0===n?void 0:n[1]]},S=function(){var t,e=(null!==(t=(0,r.W)({contract:(0,i.sJ)(u),method:"token",args:[]}))&&void 0!==t?t:{}).value;return null===e||void 0===e?void 0:e[0]},p=function(t){var e=(0,i.sJ)(t),n=(0,o.j)(e,"offer",{transactionName:"Offer Swap"}),a=n.send;return{offer:function(t,e,n,r){return a(t,e,n,r)},offerState:n.state}},g=function(t){var e=(0,i.sJ)(t),n=(0,o.j)(e,"take",{transactionName:"Take Swap"}),a=n.send;return{take:function(t){return a(t)},takeState:n.state}},N=function(t){var e=(0,i.sJ)(t),n=(0,o.j)(e,"cancel",{transactionName:"Cancel Swap Offer"}),a=n.send;return{cancel:function(t){return a(t)},cancelState:n.state}},b=function(t){var e=(0,i.sJ)(t),n=(0,o.j)(e,"settle",{transactionName:"Settle"}),a=n.send;return{settle:function(t){return a(t)},settleState:n.state}},x=function(t){var e=(0,i.sJ)(t),n=(0,o.j)(e,"withdraw",{transactionName:"Withdraw"}),a=n.send;return{withdraw:function(t){return a(t)},withdrawState:n.state}},j=function(t){return{id:t.id.toNumber(),maker:A(t.maker),taker:A(t.taker)}},A=function(t){var e=t.user!=a.d;return{user:e?t.user:void 0,createdAt:e?new Date(1e3*t.createdAt.toNumber()):void 0,amount:t.amount,period:t.period.toNumber(),shares:t.shares,isSettled:t.isSettled,totalWithdrawn:t.totalWithdrawn,withdrawal:{unbondNonce:0==t.withdrawal.unbondNonce.toNumber()?void 0:t.withdrawal.unbondNonce.toNumber(),isClaimed:t.withdrawal.isClaimed,amount:t.withdrawal.amount.isZero()?void 0:t.withdrawal.amount}}}},4063:function(t,e,n){"use strict";n.r(e);var a=n(5893),r=n(7294),o=n(1163),i=n(2593),u=n(7495),s=n(7979),l=n(5582),c=n(5616),d=n(9417),f=n(8703),v=n(1737),m=n(3795),h=n(5861),w=n(6886),S=n(563),p=n(8456),g=n(1291),N=n(1762),b=n(3111),x=n(5553),j=n(7737);e.default=function(){var t,e,n,A=(0,r.useState)(""),C=A[0],Z=A[1],k=(0,r.useState)(""),M=k[0],W=k[1],I=(0,r.useState)(""),T=I[0],E=I[1],O=(0,r.useState)(""),z=O[0],P=O[1],_=(0,r.useState)(""),D=_[0],J=_[1],y=(0,r.useState)(""),F=y[0],$=y[1],V=(0,r.useState)(""),G=V[0],L=V[1],K=(0,r.useState)(!1),q=K[0],B=K[1],H=(0,r.useState)(!1),Q=H[0],R=H[1],X=(0,u.K)(),U=X.chainId,Y=X.account,tt=(0,b.ZV)(U),et=tt.offer,nt=tt.offerState,at=(0,g.Fx)(U,"MATIC",Y,N.SEPOLIA.STAKING_SWAPS),rt=(0,g.ZG)(U,"MATIC",N.SEPOLIA.STAKING_SWAPS),ot=rt.approveErc20,it=rt.approveErc20State,ut=(0,o.useRouter)(),st=(0,r.useState)(!1),lt=st[0],ct=st[1],dt=(0,r.useState)(!1),ft=(dt[0],dt[1]);(0,r.useEffect)((function(){"Mining"===nt.status&&(J(""),ft(!0)),"Success"===nt.status&&(console.log(">>> Swap createad!"),$("Swap offer created successfully!"),L(nt.transaction.hash),J(""),ft(!1),ct(!0),vt()),"Fail"===nt.status&&(ft(!1),J("Transaction failed. (".concat(nt.errorMessage,")"))),"Exception"===nt.status&&(ft(!1),J(nt.errorMessage))}),[null===nt||void 0===nt?void 0:nt.status,null===nt||void 0===nt||null===(t=nt.transaction)||void 0===t?void 0:t.hash]),(0,r.useEffect)((function(){"Mining"===it.status&&(J(""),ft(!0),R(!0)),"Success"===it.status&&(console.log(">>> Tolen transfer approved!"),$("MATIC transfer approved!"),L(it.transaction.hash),ft(!1),ct(!0)),"Fail"===it.status&&(ft(!1),J("Transaction failed. (".concat(it.errorMessage,")"))),"Exception"===it.status&&(ft(!1),J(it.errorMessage))}),[null===it||void 0===it?void 0:it.status,null===it||void 0===it||null===(e=it.transaction)||void 0===e?void 0:e.hash]),(0,r.useEffect)((function(){var t=!(!isNaN(Number(C))&&Number(C)>0)||at&&at.gte(i.O$.from(C).mul(i.O$.from(10).pow(18))),e="Mining"===(null===it||void 0===it?void 0:it.status)||"Mining"===(null===nt||void 0===nt?void 0:nt.status);!0===t?(console.log(">>> NewSwapPage - show submit step - allowance:",null===at||void 0===at?void 0:at.toString(),"showSumbitStep:",t),B(!1),J("")):!1===e&&(console.log(">>> NewSwapPage - show allowance step - allowance:",null===at||void 0===at?void 0:at.toString(),"showSumbitStep:",t),B(!0),at&&J("Approve MATIC transfer to create swap. (Current allowance is ".concat((0,x.formatEther)(at)," MATIC.)")))}),[at,C]),(0,r.useEffect)((function(){R(!1)}),[at]);var vt=function(){Z(""),W(""),E(""),P(""),J("")},mt=function(t){var e=at,n=i.O$.from(t.swapSizeFirst).mul(i.O$.from(10).pow(18)),a=86400*t.swapDurationFirst,r=i.O$.from(t.swapSizeSecond).mul(i.O$.from(10).pow(18)),o=86400*t.swapDurationSecond;if(console.log("createSwap - userAllowance: ",e.toString(),"firstLegAmount",n.toString()),e.lt(n))return console.log("User allowance is less than swap size"),B(!0),void J("Approve MATIC transfer to create the swap. (Current allowance is ".concat((0,x.formatEther)(e)," MATIC.)"));et(n.toString(),a,r.toString(),o)},ht=function(t,e){"clickaway"!==e&&ct(!1)},wt=!isNaN(Number(C))&&Number(C)>0;return(0,a.jsx)(l.Z,{maxWidth:"md",children:(0,a.jsxs)(c.Z,{sx:{mt:4,mb:4},children:[(0,a.jsx)(c.Z,{sx:{mb:4},children:(0,a.jsx)(d.Z,{variant:"outlined",onClick:function(){ut.push("/?selectedTab=offers")},children:"Back"})}),(0,a.jsx)(f.Z,{open:lt,autoHideDuration:1e4,onClose:ht,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,a.jsxs)(v.Z,{onClose:ht,severity:"success",sx:{width:"100%"},children:[F,(0,a.jsx)("br",{}),"View on block explorer: "," ",(0,a.jsx)(m.Z,{href:(0,j.q)("SEPOLIA",null===nt||void 0===nt||null===(n=nt.transaction)||void 0===n?void 0:n.hash,"transaction"),target:"_blank",children:G})]})}),(0,a.jsx)(h.Z,{variant:"h5",sx:{my:4},fontWeight:600,children:"New Swap Offer"}),(0,a.jsx)("form",{onSubmit:function(t){if(t.preventDefault(),C&&M&&T&&z?isNaN(Number(C))||isNaN(Number(M))||isNaN(Number(T))||isNaN(Number(z))?(J("All fields must be valid numbers"),0):0!==Number(C)&&0!==Number(M)&&0!==Number(T)&&0!==Number(z)||(J("All fields should be greater than 0."),0):(J("All fields are required"),0)){if(void 0===Y||U!==s.m4.chainId)return void J("Please connect your wallet to Sepolia.");mt({swapSizeFirst:Number(C),swapDurationFirst:Number(M),swapSizeSecond:Number(T),swapDurationSecond:Number(z)})}},onChange:function(t){console.log("handleChange - val",t.target.value,"name:",t.target.name);var e=C,n=M,a=T,r=z;switch(t.target.name){case"swapSizeFirst":e=t.target.value;break;case"swapDurationFirst":n=t.target.value;break;case"swapSizeSecond":a=t.target.value;break;case"swapDurationSecond":r=t.target.value}e&&isNaN(Number(e))||n&&isNaN(Number(n))||a&&isNaN(Number(a))||r&&isNaN(Number(r))?J("All fields must be valid numbers."):(e&&0===Number(e)||n&&0===Number(n)||a&&0===Number(a)||r&&0===Number(r))&&J("All fields should be greater than 0.")},children:(0,a.jsxs)(w.ZP,{container:!0,spacing:4,children:[(0,a.jsxs)(w.ZP,{item:!0,xs:12,sm:6,children:[(0,a.jsx)(h.Z,{fontWeight:500,fontSize:20,children:"Maker Side"}),(0,a.jsx)(S.Z,{name:"swapSizeFirst",label:"Size (MATIC)",variant:"outlined",fullWidth:!0,value:C,onChange:function(t){return Z(t.target.value)},margin:"normal",autoComplete:"off"}),(0,a.jsx)(S.Z,{name:"swapDurationFirst",label:"Duration (days)",variant:"outlined",fullWidth:!0,value:M,onChange:function(t){return W(t.target.value)},margin:"normal",autoComplete:"off"})]}),(0,a.jsxs)(w.ZP,{item:!0,xs:12,sm:6,children:[(0,a.jsx)(h.Z,{fontWeight:500,fontSize:20,children:"Taker Side"}),(0,a.jsx)(S.Z,{name:"swapSizeSecond",label:"Size (MATIC)",variant:"outlined",fullWidth:!0,value:T,onChange:function(t){return E(t.target.value)},margin:"normal",autoComplete:"off"}),(0,a.jsx)(S.Z,{name:"swapDurationSecond",label:"Duration (days)",variant:"outlined",fullWidth:!0,value:z,onChange:function(t){return P(t.target.value)},margin:"normal",autoComplete:"off"})]}),(0,a.jsx)(w.ZP,{xs:12,textAlign:"center",children:(0,a.jsxs)(h.Z,{style:{paddingBottom:10},color:"error",children:[D," \xa0"]})}),(0,a.jsxs)(w.ZP,{xs:12,textAlign:"center",children:[!0===q&&wt&&(0,a.jsx)(d.Z,{onClick:function(){if(void 0!==Y&&U===s.m4.chainId){var t=i.O$.from(C).mul(i.O$.from(10).pow(18));ot(t.toString())}else J("Please connect your wallet to Sepolia.")},variant:"contained",color:"primary",disabled:"Mining"===it.status||!0===Q,startIcon:"Mining"===it.status||!0===Q?(0,a.jsx)(p.Z,{size:20}):null,children:"Approve MATIC transfer"}),(0==q||0==wt)&&(0,a.jsx)(d.Z,{type:"submit",variant:"contained",color:"primary",disabled:"Mining"===nt.status,startIcon:"Mining"===nt.status?(0,a.jsx)(p.Z,{size:20}):null,children:"Mining"===nt.status?"Submitting Swap Offer...":"Submit Swap Offer "})]})]})})]})})}}},function(t){t.O(0,[231,819,774,888,179],(function(){return e=4188,t(t.s=e);var e}));var e=t.O();_N_E=e}]);