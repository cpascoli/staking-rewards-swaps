(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{8826:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/offer/[id]",function(){return n(9700)}])},9700:function(e,t,n){"use strict";n.r(t);var a=n(5893),s=n(7294),o=n(1163),i=n(7495),r=n(1291),l=n(3111),c=n(5616),d=n(3795),u=n(9417),f=n(8456),v=n(5861),h=n(8703),k=n(1737),g=n(1762),p=n(7737),x=n(2485),m=n(5553);t.default=function(){var e,t,n,w,S,A,T,j,C,M=(0,o.useRouter)(),E=M.query.id,I=(0,s.useState)(""),Z=I[0],b=I[1],N=(0,s.useState)(!1),_=N[0],O=N[1],P=(0,i.K)(),y=P.chainId,z=P.account,B=(0,r.Fx)(y,"MATIC",z,g.SEPOLIA.STAKING_SWAPS),L=(0,r.mM)(y,"MATIC",z),D=(0,l.hf)(y),G=D.take,q=D.takeState,F=(0,l.kH)(y),K=F.cancel,U=F.cancelState,W=(0,r.ZG)(y,"MATIC",g.SEPOLIA.STAKING_SWAPS),H=W.approveErc20,X=W.approveErc20State,R=(0,l.jv)(Number(E)),V=(0,s.useState)(!1),J=V[0],Q=V[1],Y=(0,s.useState)(!1),$=(Y[0],Y[1]);(0,s.useEffect)((function(){"Mining"===q.status&&(b(""),$(!0)),"Success"===q.status&&(b(""),$(!1),Q(!0),M.push("/swap/".concat(null===R||void 0===R?void 0:R.id))),"Fail"===q.status&&($(!1),b("Transaction failed. (".concat(q.errorMessage,")"))),"Exception"===q.status&&($(!1),b("Transaction error. (".concat(q.errorMessage,")")))}),[null===q||void 0===q?void 0:q.status,null===q||void 0===q||null===(e=q.transaction)||void 0===e?void 0:e.hash]),(0,s.useEffect)((function(){console.log(">> OfferDetailPage - cancel offer useEffect - cancelState:",null===U||void 0===U?void 0:U.status),"Mining"===U.status&&(b(""),$(!0)),"Success"===U.status&&(b(""),$(!1),Q(!0),setTimeout((function(){M.push("/?selectedTab=offers")}),5e3)),"Exception"===U.status&&b("User denied transaction signature.")}),[null===U||void 0===U?void 0:U.status,null===U||void 0===U||null===(t=U.transaction)||void 0===t?void 0:t.hash]),(0,s.useEffect)((function(){"Mining"===X.status&&$(!0),"Success"===X.status&&(b(""),$(!1)),"Fail"===X.status&&($(!1),b("Transaction failed. (".concat(X.errorMessage,")"))),"Exception"===X.status&&($(!1),b("Transaction error. (".concat(X.errorMessage,")")))}),[null===X||void 0===X?void 0:X.status,null===X||void 0===X||null===(n=X.transaction)||void 0===n?void 0:n.hash]),(0,s.useEffect)((function(){if(console.log(">> OfferDetailPage - useEffect - allowance:",null===B||void 0===B?void 0:B.toString()),!0===_){var e=R&&B&&B.lt(R.taker.amount);O(e)}}),[B]);var ee=function(e,t){"clickaway"!==t&&Q(!1)};if(!R)return(0,a.jsx)(c.Z,{textAlign:"center",sx:{marginTop:10,marginBottom:8},children:"Loading..."});if(0===R.id)return(0,a.jsxs)(c.Z,{textAlign:"center",sx:{marginTop:10,marginBottom:8},children:["Offer not found",(0,a.jsx)(c.Z,{sx:{paddingTop:2},children:(0,a.jsx)(d.Z,{onClick:function(){return M.push("/")},children:"Go to Offers"})})]});var te="None"!==U.status?"Swap offer taken":"None"!==U.status?"Swap offer cancelled":"",ne=R&&B&&B.lt(R.taker.amount);return console.log(">>> OfferDetailPage - offer:",R,"allowance:",null===B||void 0===B?void 0:B.toString(),"insufficientAllowance:",ne,"allowanceStep:",_),(0,a.jsxs)("div",{style:{paddingTop:20,paddingBottom:20},children:[(0,a.jsx)(u.Z,{variant:"outlined",onClick:function(){M.push("/?selectedTab=offers")},children:"Back"}),(0,a.jsxs)("h1",{children:["Swap Offer ",E]}),R&&(0,a.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",margin:"auto"},children:[(0,a.jsx)(x.Z,{swapId:Number(E),side:"Maker",createdAt:R.maker.createdAt,takenAt:R.taker.createdAt,address:R.maker.user,size:R.maker.amount,duration:R.maker.period,shares:void 0,rewards:void 0,isSettled:void 0,isClaimed:void 0,canSettle:void 0,withdrawNonce:void 0}),(0,a.jsx)(x.Z,{swapId:Number(E),side:"Taker",createdAt:R.maker.createdAt,takenAt:R.taker.createdAt,address:R.taker.user,size:R.taker.amount,duration:R.taker.period,shares:void 0,rewards:void 0,isSettled:void 0,isClaimed:void 0,canSettle:void 0,withdrawNonce:void 0})]}),(0,a.jsxs)(c.Z,{sx:{mb:4,textAlign:"center"},children:[!R.taker.user&&R.maker.user!==z&&ne&&_&&(0,a.jsx)(u.Z,{variant:"contained",onClick:function(){H(R.taker.amount.toString())},disabled:"Mining"===X.status,startIcon:"Mining"===X.status?(0,a.jsx)(f.Z,{size:20}):null,children:"Approve MATIC transfer"}),!R.taker.user&&R.maker.user!==z&&!_&&(0,a.jsx)(u.Z,{variant:"contained",onClick:function(){return B.lt(R.taker.amount)?(console.log("User allowance is less than swap size"),b("Not enough allowance to take swap (Current allowance is ".concat((0,m.formatEther)(B)," MATIC.)")),void O(!0)):(console.log(">>> maticBalance:",L),void 0!==L&&L.lt(R.taker.amount)?(console.log("MATIC balance is less than swap size"),void b("Not enough MATIC to take swap (MATIC balance is ".concat((0,m.formatEther)(L)," MATIC.)"))):R.maker.user===z?(console.log("User taking their own offer"),void b("Cannot take your own offer")):void G(Number(E)))},disabled:"Mining"===q.status,startIcon:"Mining"===q.status?(0,a.jsx)(f.Z,{size:20}):null,children:"Take Offer"}),!R.taker.user&&R.maker.user===z&&(0,a.jsx)(u.Z,{variant:"contained",onClick:function(){K(Number(E))},disabled:"Mining"===U.status,startIcon:"Mining"===U.status?(0,a.jsx)(f.Z,{size:20}):null,children:"Cancel Offer"}),Z&&(0,a.jsx)(c.Z,{sx:{paddingTop:1},children:(0,a.jsx)(v.Z,{color:"error",children:Z})})]}),(0,a.jsx)(h.Z,{open:J,autoHideDuration:6e3,onClose:ee,children:(0,a.jsxs)(k.Z,{onClose:ee,severity:"success",sx:{width:"100%"},children:[te,(0,a.jsx)("br",{}),"View on block explorer: "," ",(null===q||void 0===q||null===(w=q.transaction)||void 0===w?void 0:w.hash)&&(0,a.jsx)(d.Z,{href:(0,p.q)("SEPOLIA",null===q||void 0===q||null===(S=q.transaction)||void 0===S?void 0:S.hash,"transaction"),target:"_blank",children:null===q||void 0===q||null===(A=q.transaction)||void 0===A?void 0:A.hash}),(null===U||void 0===U||null===(T=U.transaction)||void 0===T?void 0:T.hash)&&(0,a.jsx)(d.Z,{href:(0,p.q)("SEPOLIA",null===U||void 0===U||null===(j=U.transaction)||void 0===j?void 0:j.hash,"transaction"),target:"_blank",children:null===U||void 0===U||null===(C=U.transaction)||void 0===C?void 0:C.hash})]})})]})}}},function(e){e.O(0,[430,858,485,774,888,179],(function(){return t=8826,e(e.s=t);var t}));var t=e.O();_N_E=t}]);