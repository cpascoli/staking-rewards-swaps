(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{8826:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/offer/[id]",function(){return n(9700)}])},9700:function(e,t,n){"use strict";n.r(t);var a=n(5893),s=n(7294),i=n(1163),o=n(7495),r=n(1291),l=n(3111),c=n(5616),d=n(3795),u=n(9417),f=n(8456),v=n(5861),h=n(8703),k=n(1737),g=n(1762),p=n(7737),x=n(2485),m=n(5553);t.default=function(){var e,t,n,S,w,A,j,M,C,T=(0,i.useRouter)(),I=(0,o.K)(),Z=I.chainId,E=I.account,b=T.query.id,_=(0,s.useState)(""),N=_[0],O=_[1],y=(0,s.useState)(!1),P=y[0],z=y[1],L=(0,l.jv)(Number(b)),B=(0,r.Fx)(Z,"MATIC",E,g.SEPOLIA.STAKING_SWAPS),D=(0,r.mM)(Z,"MATIC",E),G=(0,l.hf)(Z),W=G.take,q=G.takeState,F=(0,l.kH)(Z),K=F.cancel,H=F.cancelState,R=(0,r.ZG)(Z,"MATIC",g.SEPOLIA.STAKING_SWAPS),U=R.approveErc20,X=R.approveErc20State,V=(0,s.useState)(!1),J=V[0],Q=V[1],Y=(0,s.useState)(!1),$=(Y[0],Y[1]),ee=(0,s.useState)(!1),te=ee[0],ne=ee[1],ae=(0,s.useState)(""),se=ae[0],ie=ae[1],oe=(0,s.useState)(!1),re=oe[0],le=oe[1];(0,s.useEffect)((function(){"Mining"===q.status&&(ie(""),O(""),$(!0)),"Success"===q.status&&(O(""),$(!1),Q(!0),ie("Swap offer taken successfully")),"Fail"===q.status&&($(!1),O("Transaction failed. (".concat(q.errorMessage,")"))),"Exception"===q.status&&($(!1),O(q.errorMessage))}),[null===q||void 0===q?void 0:q.status,null===q||void 0===q||null===(e=q.transaction)||void 0===e?void 0:e.hash]),(0,s.useEffect)((function(){console.log(">> OfferDetailPage - cancel offer useEffect - cancelState:",null===H||void 0===H?void 0:H.status),"Mining"===H.status&&(ie(""),O(""),$(!0)),"Success"===H.status&&(O(""),$(!1),Q(!0),ie("Swap offer cancelled successfully"),le(!0)),"Exception"===H.status&&O(H.errorMessage)}),[null===H||void 0===H?void 0:H.status,null===H||void 0===H||null===(t=H.transaction)||void 0===t?void 0:t.hash]),(0,s.useEffect)((function(){"Mining"===X.status&&(ie(""),O(""),$(!0),ne(!0)),"Success"===X.status&&(ie("MATIC transfer approved successfully"),O(""),$(!1)),"Fail"===X.status&&($(!1),O("Transaction failed. (".concat(X.errorMessage,")"))),"Exception"===X.status&&($(!1),O(X.errorMessage))}),[null===X||void 0===X?void 0:X.status,null===X||void 0===X||null===(n=X.transaction)||void 0===n?void 0:n.hash]),(0,s.useEffect)((function(){if(console.log(">> OfferDetailPage - useEffect - allowance:",null===B||void 0===B?void 0:B.toString()),!0===P){var e=L&&B&&B.lt(L.taker.amount);z(e)}ne(!1)}),[B]);var ce=function(e,t){"clickaway"!==t&&Q(!1)};if(!L)return(0,a.jsx)(c.Z,{textAlign:"center",sx:{marginTop:10,marginBottom:8},children:"Loading..."});if(0===L.id)return(0,a.jsxs)(c.Z,{textAlign:"center",sx:{marginTop:10,marginBottom:8},children:["Offer not found",(0,a.jsx)(c.Z,{sx:{paddingTop:2},children:(0,a.jsx)(d.Z,{onClick:function(){return T.push("/")},children:"Go to Offers"})})]});var de=L&&B&&B.lt(L.taker.amount);return console.log(">>> OfferDetailPage - offer:",L,"allowance:",null===B||void 0===B?void 0:B.toString(),"insufficientAllowance:",de,"allowanceStep:",P),(0,a.jsxs)("div",{style:{paddingTop:20,paddingBottom:20},children:[(0,a.jsx)(u.Z,{variant:"outlined",onClick:function(){T.push("/?selectedTab=offers")},children:"Back"}),(0,a.jsxs)("h1",{children:["Swap Offer ",b]}),L&&(0,a.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",margin:"auto"},children:[(0,a.jsx)(x.Z,{swapId:Number(b),side:"Maker",createdAt:L.maker.createdAt,takenAt:L.taker.createdAt,address:L.maker.user,size:L.maker.amount,duration:L.maker.period,shares:void 0,rewards:void 0,isSettled:void 0,isClaimed:void 0,canSettle:void 0,withdrawNonce:void 0}),(0,a.jsx)(x.Z,{swapId:Number(b),side:"Taker",createdAt:L.maker.createdAt,takenAt:L.taker.createdAt,address:L.taker.user,size:L.taker.amount,duration:L.taker.period,shares:void 0,rewards:void 0,isSettled:void 0,isClaimed:void 0,canSettle:void 0,withdrawNonce:void 0})]}),(0,a.jsxs)(c.Z,{sx:{mb:4,textAlign:"center"},children:[!L.taker.user&&L.maker.user!==E&&de&&P&&!1===re&&(0,a.jsx)(u.Z,{variant:"contained",onClick:function(){U(L.taker.amount.toString())},disabled:"Mining"===X.status||!0===te,startIcon:"Mining"===X.status||!0===te?(0,a.jsx)(f.Z,{size:20}):null,children:"Approve MATIC transfer"}),!L.taker.user&&L.maker.user!==E&&!P&&!1===re&&(0,a.jsx)(u.Z,{variant:"contained",onClick:function(){return B.lt(L.taker.amount)?(console.log("User allowance is less than swap size"),O("Approve MATIC transfer to take swap. (Current allowance is ".concat((0,m.formatEther)(B)," MATIC.)")),void z(!0)):void 0!==D&&D.lt(L.taker.amount)?(console.log("MATIC balance is less than swap size"),void O("Not enough MATIC to take swap (MATIC balance is ".concat((0,m.formatEther)(D)," MATIC.)"))):L.maker.user===E?(console.log("User taking their own offer"),void O("Cannot take your own offer")):void W(Number(b))},disabled:"Mining"===q.status,startIcon:"Mining"===q.status?(0,a.jsx)(f.Z,{size:20}):null,children:"Take Offer"}),!L.taker.user&&L.maker.user===E&&!1===re&&(0,a.jsx)(u.Z,{variant:"contained",onClick:function(){K(Number(b))},disabled:"Mining"===H.status,startIcon:"Mining"===H.status?(0,a.jsx)(f.Z,{size:20}):null,children:"Cancel Offer"}),N&&(0,a.jsx)(c.Z,{sx:{paddingTop:1},children:(0,a.jsx)(v.Z,{color:"error",children:N})}),re&&(0,a.jsx)(c.Z,{textAlign:"center",children:(0,a.jsx)(c.Z,{sx:{mt:2,marginLeft:"auto",marginRight:"auto"},alignItems:"center",style:{maxWidth:200},children:(0,a.jsx)(v.Z,{color:"success",children:"Offer cancelled"})})})]}),(0,a.jsx)(h.Z,{open:J,autoHideDuration:6e3,onClose:ce,children:(0,a.jsxs)(k.Z,{onClose:ce,severity:"success",sx:{width:"100%"},children:[se,(0,a.jsx)("br",{}),"View on block explorer: "," ",(null===q||void 0===q||null===(S=q.transaction)||void 0===S?void 0:S.hash)&&(0,a.jsx)(d.Z,{href:(0,p.q)("SEPOLIA",null===q||void 0===q||null===(w=q.transaction)||void 0===w?void 0:w.hash,"transaction"),target:"_blank",children:null===q||void 0===q||null===(A=q.transaction)||void 0===A?void 0:A.hash}),(null===H||void 0===H||null===(j=H.transaction)||void 0===j?void 0:j.hash)&&(0,a.jsx)(d.Z,{href:(0,p.q)("SEPOLIA",null===H||void 0===H||null===(M=H.transaction)||void 0===M?void 0:M.hash,"transaction"),target:"_blank",children:null===H||void 0===H||null===(C=H.transaction)||void 0===C?void 0:C.hash})]})})]})}}},function(e){e.O(0,[901,156,628,485,774,888,179],(function(){return t=8826,e(e.s=t);var t}));var t=e.O();_N_E=t}]);