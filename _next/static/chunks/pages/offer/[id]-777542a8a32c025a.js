(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{8826:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/offer/[id]",function(){return a(9700)}])},9700:function(e,t,a){"use strict";a.r(t);var n=a(5893),s=a(7294),r=a(1163),i=a(7495),o=a(1291),c=a(3111),l=a(5616),d=a(3795),u=a(9417),f=a(8456),v=a(5861),h=a(8703),k=a(1737),g=a(1762),x=a(7737),p=a(2485),m=a(5553);t.default=function(){var e,t,a,S=(0,r.useRouter)(),w=(0,i.K)(),A=w.chainId,j=w.account,C=S.query.id,M=(0,s.useState)(""),T=M[0],Z=M[1],I=(0,s.useState)(!1),E=I[0],b=I[1],O=(0,c.jv)(Number(C)),N=(0,o.Fx)(A,"MATIC",j,g.SEPOLIA.STAKING_SWAPS),_=(0,o.mM)(A,"MATIC",j),P=(0,c.hf)(A),y=P.take,z=P.takeState,L=(0,c.kH)(A),D=L.cancel,G=L.cancelState,R=(0,o.ZG)(A,"MATIC",g.SEPOLIA.STAKING_SWAPS),W=R.approveErc20,B=R.approveErc20State,F=(0,s.useState)(!1),K=F[0],q=F[1],H=(0,s.useState)(!1),U=(H[0],H[1]),X=(0,s.useState)(!1),V=X[0],J=X[1],Q=(0,s.useState)(""),Y=Q[0],$=Q[1],ee=(0,s.useState)(""),te=ee[0],ae=ee[1],ne=(0,s.useState)(!1),se=ne[0],re=ne[1];(0,s.useEffect)((function(){"Mining"===z.status&&($(""),Z(""),U(!0)),"Success"===z.status&&(console.log("swap offer taken"),$("Swap offer taken"),q(!0),ae(z.transaction.hash),Z(""),U(!1)),"Fail"===z.status&&(U(!1),Z("Transaction failed. (".concat(z.errorMessage,")"))),"Exception"===z.status&&(U(!1),Z(z.errorMessage))}),[null===z||void 0===z?void 0:z.status,null===z||void 0===z||null===(e=z.transaction)||void 0===e?void 0:e.hash]),(0,s.useEffect)((function(){console.log(">> OfferDetailPage - cancel offer useEffect - cancelState:",null===G||void 0===G?void 0:G.status),"Mining"===G.status&&($(""),Z(""),U(!0)),"Success"===G.status&&(q(!0),$("Swap offer cancelled"),ae(G.transaction.hash),Z(""),U(!1),re(!0)),"Exception"===G.status&&Z(G.errorMessage)}),[null===G||void 0===G?void 0:G.status,null===G||void 0===G||null===(t=G.transaction)||void 0===t?void 0:t.hash]),(0,s.useEffect)((function(){"Mining"===B.status&&($(""),Z(""),U(!0),J(!0)),"Success"===B.status&&($("MATIC transfer approved"),ae(B.transaction.hash),Z(""),U(!1),q(!0)),"Fail"===B.status&&(U(!1),Z("Transaction failed. (".concat(B.errorMessage,")"))),"Exception"===B.status&&(U(!1),Z(B.errorMessage))}),[null===B||void 0===B?void 0:B.status,null===B||void 0===B||null===(a=B.transaction)||void 0===a?void 0:a.hash]),(0,s.useEffect)((function(){if(console.log(">> OfferDetailPage - useEffect - allowance:",null===N||void 0===N?void 0:N.toString()),!0===E){var e=O&&N&&N.lt(O.taker.amount);b(e)}J(!1)}),[N]);var ie=function(e,t){"clickaway"!==t&&q(!1)};if(!O)return(0,n.jsx)(l.Z,{textAlign:"center",sx:{marginTop:10,marginBottom:8},children:"Loading..."});if(0===O.id)return(0,n.jsxs)(l.Z,{textAlign:"center",sx:{marginTop:10,marginBottom:8},children:["Offer not found",(0,n.jsx)(l.Z,{sx:{paddingTop:2},children:(0,n.jsx)(d.Z,{onClick:function(){return S.push("/")},children:"Go to Offers"})})]});var oe=O&&N&&N.lt(O.taker.amount);return console.log(">> OfferDetailPage - offer:",O,"allowance:",null===N||void 0===N?void 0:N.toString()),(0,n.jsxs)(l.Z,{sx:{px:1,mt:3},children:[(0,n.jsx)(u.Z,{variant:"outlined",onClick:function(){S.push("/?selectedTab=offers")},children:"Back"}),(0,n.jsxs)("h1",{children:["Swap Offer ",C]}),O&&(0,n.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",margin:"auto"},children:[(0,n.jsx)(p.Z,{swapId:Number(C),side:"Maker",createdAt:O.maker.createdAt,takenAt:O.taker.createdAt,address:O.maker.user,size:O.maker.amount,duration:O.maker.period,shares:void 0,rewards:void 0,otherSideRewards:void 0,isSettled:void 0,isClaimed:void 0,isOtherSideClaimed:void 0,canSettle:void 0,withdrawNonce:void 0}),(0,n.jsx)(p.Z,{swapId:Number(C),side:"Taker",createdAt:O.maker.createdAt,takenAt:O.taker.createdAt,address:O.taker.user,size:O.taker.amount,duration:O.taker.period,shares:void 0,rewards:void 0,otherSideRewards:void 0,isSettled:void 0,isClaimed:void 0,isOtherSideClaimed:void 0,canSettle:void 0,withdrawNonce:void 0})]}),(0,n.jsxs)(l.Z,{sx:{mb:4,textAlign:"center"},children:[!O.taker.user&&O.maker.user!==j&&oe&&E&&!1===se&&(0,n.jsx)(u.Z,{variant:"contained",onClick:function(){W(O.taker.amount.toString())},disabled:"Mining"===B.status||!0===V,startIcon:"Mining"===B.status||!0===V?(0,n.jsx)(f.Z,{size:20}):null,children:"Approve MATIC transfer"}),!O.taker.user&&O.maker.user!==j&&!E&&!1===se&&(0,n.jsx)(u.Z,{variant:"contained",onClick:function(){return N.lt(O.taker.amount)?(console.log("User allowance is less than swap size"),Z("Approve MATIC transfer to take swap. (Current allowance is ".concat((0,m.formatEther)(N)," MATIC.)")),void b(!0)):void 0!==_&&_.lt(O.taker.amount)?(console.log("MATIC balance is less than swap size"),void Z("Not enough MATIC to take swap (MATIC balance is ".concat((0,m.formatEther)(_)," MATIC.)"))):O.maker.user===j?(console.log("User taking their own offer"),void Z("Cannot take your own offer")):void y(Number(C))},disabled:"Mining"===z.status||void 0===N,startIcon:"Mining"===z.status?(0,n.jsx)(f.Z,{size:20}):null,children:"Take Offer"}),!O.taker.user&&O.maker.user===j&&!1===se&&(0,n.jsx)(u.Z,{variant:"contained",onClick:function(){D(Number(C))},disabled:"Mining"===G.status,startIcon:"Mining"===G.status?(0,n.jsx)(f.Z,{size:20}):null,children:"Cancel Offer"}),T&&(0,n.jsx)(l.Z,{sx:{paddingTop:1},children:(0,n.jsx)(v.Z,{color:"error",children:T})}),se&&(0,n.jsx)(l.Z,{textAlign:"center",children:(0,n.jsx)(l.Z,{sx:{mt:2,marginLeft:"auto",marginRight:"auto"},alignItems:"center",style:{maxWidth:200},children:(0,n.jsx)(v.Z,{color:"success",children:"Offer cancelled"})})})]}),(0,n.jsx)(h.Z,{open:K,autoHideDuration:1e4,onClose:ie,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,n.jsxs)(k.Z,{onClose:ie,severity:"success",sx:{width:"100%"},children:[Y,(0,n.jsx)("br",{}),"View on block explorer: "," ",(0,n.jsx)(d.Z,{href:(0,x.q)("SEPOLIA",te,"transaction"),target:"_blank",children:te})]})})]})}}},function(e){e.O(0,[231,485,774,888,179],(function(){return t=8826,e(e.s=t);var t}));var t=e.O();_N_E=t}]);